(function(){function h(a){if("number"!==typeof a.length||0===a.length)return[];var d=[],b;for(b in a[0])d.push({headerText:b,rowText:b});return d}ko.agoGrid={viewModel:function(a){this.data=this.allData=a.data;this.displayRowCount=void 0===a.displayRowCount?!0:a.displayRowCount;this.displaySearch=void 0===a.displaySearch?!0:a.displaySearch;this.displayPagination=void 0===a.displayPagination?!0:a.displayPagination;this.rowCallback=a.rowCallback;this.currentPageIndex=ko.observable(0);this.pageSize= ko.observable(a.pageSize||10);this.pageSizes=ko.observableArray([10,25,50,100]);this.hasPreviousPage=ko.observable(!1);this.hasNextPage=ko.observable(!1);this.search=ko.observable("");this.filters=ko.observableArray([]);this.sortKey=ko.observable("");this.sortAsc=ko.observable(!0);this.gridId=a.gridId||"agoGrid";this.columns=a.columns||h(ko.unwrap(this.data));this.rowTemplate=a.rowTemplate||"ko_agoGrid_row";this.bodyTemplate=a.rowTemplate?"ko_agoGrid_customBody":"ko_agoGrid_body";this.data=ko.computed(function(){var d= [];if(0<this.filters().length)for(var b=0;b<this.filters().length;b++)for(var a=0;a<this.allData().length;a++)void 0!==this.allData()[a][this.filters()[b].column]&&this.allData()[a][this.filters()[b].column]===this.filters()[b].value&&d.push(this.allData()[a]);else d=this.allData().slice();if(0<$.trim(this.search()).length)for(b=d.length-1;0<=b;b--){for(var c=!1,a=0;a<this.columns.length;a++)if(this.columns[a].rowText&&0<this.columns[a].rowText.length&&0<=(""+d[b][this.columns[a].rowText]).toLowerCase().indexOf(this.search())){c= !0;break}c||d.splice(b,1)}if(0<this.sortKey().length)var e=this.sortKey(),k=this.sortAsc(),d=d.sort(function(a,b){var d=ko.utils.unwrapObservable(a[e]),c=ko.utils.unwrapObservable(b[e]);if("string"===typeof a[e]||"object"===typeof a[e])d=(""+a[e]).toLowerCase(),c=(""+b[e]).toLowerCase();if(k){if(d<c)return-1;if(d>c)return 1}else{if(d>c)return-1;if(d<c)return 1}return 0});return d},this);this.rowCount=ko.computed(function(){return this.data().length},this);this.itemsOnCurrentPage=ko.computed(function(){if(this.displayPagination){var a= this.pageSize()*this.currentPageIndex();return ko.unwrap(this.data).slice(a,a+this.pageSize())}return ko.unwrap(this.data)},this);this.maxPageIndex=ko.computed(function(){this.currentPageIndex(0);return Math.ceil(ko.unwrap(this.data).length/this.pageSize())-1},this);this.rangeMin=ko.computed(function(){return this.pageSize()*this.currentPageIndex()+1},this);this.rangeMax=ko.computed(function(){return this.pageSize()*this.currentPageIndex()+this.itemsOnCurrentPage().length},this);this.range=ko.computed(function(){return this.rangeMin()+ "-"+this.rangeMax()+"/"+this.rowCount()},this);this.gotoPreviousPage=function(){this.hasPreviousPage()&&this.currentPageIndex(this.currentPageIndex()-1)};this.gotoNextPage=function(){this.hasNextPage()&&this.currentPageIndex(this.currentPageIndex()+1)};this.clearSearch=function(){this.search("")};this.updatePagination=ko.computed(function(){0==this.currentPageIndex()?this.hasPreviousPage(!1):this.hasPreviousPage(!0);this.currentPageIndex()+1<=this.maxPageIndex()?this.hasNextPage(!0):this.hasNextPage(!1)}, this);this.sortBy=function(a,b){b&&0<b.length&&(b!=a.sortKey()?(a.sortAsc(!0),a.sortKey(b)):a.sortAsc(!a.sortAsc()))};this.onCellClick=function(a,b,c){a.rowCallback&&a.rowCallback(b,c.target,c.target.parentElement)};this.addFilter=function(a,b){this.filters.push({column:a,value:b})};this.resetFilters=function(){this.filters.removeAll()}}};var c=new ko.nativeTemplateEngine;c.addTemplate=function(a,c){document.write("<script type='text/html' id='"+a+"'>"+c+"\x3c/script>")};c.addTemplate("ko_agoGrid_header", '\x3c!-- ko if: displayPagination||displaySearch --\x3e<div class="row"><div class="six columns">\x3c!-- ko if:displayPagination --\x3e<div class="picker"><select data-bind="options:pageSizes, value:pageSize"></select></div>\x3c!-- /ko --\x3e</div><div class="six columns" style="text-align:right;">\x3c!-- ko if:displaySearch --\x3e<div class="prepend append field"><span class="adjoined"><i class="icon-search"></i></span><input class="normal text input" type="text" data-bind="textInput:search" /><div class="medium primary btn"><a href="#" data-bind="click:function() { clearSearch(); }">x</a></div></div>\x3c!-- /ko --\x3e</div></div>\x3c!-- /ko --\x3e'); c.addTemplate("ko_agoGrid_grid",'<table class="rounded striped" style="margin-top:0px; margin-bottom:0px;" data-bind="attr: {id:gridId}"><thead><tr data-bind="foreach: columns"><th>\x3c!-- ko ifnot: rowText==\'\' --\x3e<span style="cursor:pointer; text-overflow:ellipsis;" data-bind="text:headerText, click:sortBy.bind($data, $context, rowText)"></span>\x3c!-- ko if:rowText==sortKey() --\x3e\x3c!-- ko if:sortAsc() --\x3e<span><i class="icon-up-dir"></i></span>\x3c!-- /ko --\x3e\x3c!-- ko ifnot:sortAsc() --\x3e<span><i class="icon-down-dir"></i></span>\x3c!-- /ko --\x3e\x3c!-- /ko --\x3e\x3c!-- /ko --\x3e\x3c!-- ko if: rowText==\'\' --\x3e<span class="text-overflow:ellipsis;" data-bind="text:headerText"></span>\x3c!-- /ko --\x3e</th></tr></thead><tbody data-bind="template : { name:bodyTemplate, foreach:itemsOnCurrentPage, as:\'myrow\' }"></tbody></table>'); c.addTemplate("ko_agoGrid_body",'<tr data-bind="foreach:columns, click:onCellClick.bind($data, $context)"><td data-bind="text: typeof rowText == \'function\' ? rowText($parent) : $parent[rowText]"></td></tr>');c.addTemplate("ko_agoGrid_customBody",'<tr data-bind="template: { name:rowTemplate }, click:onCellClick.bind($data, $context)"></tr>');c.addTemplate("ko_agoGrid_footer",'\x3c!-- ko if: displayPagination||displayRowCount --\x3e<div class="row"><div class="four columns">\x3c!-- ko if:displayRowCount --\x3e<span style="font-weight:bold;" data-bind="text:range"></span>\x3c!-- /ko --\x3e</div><div class="eight columns" style="text-align:right;">\x3c!-- ko if:displayPagination --\x3e<div class="small oval default btn"><a href="#" data-bind="click:function() { gotoPreviousPage(); }"><<</a></div>\x3c!-- ko foreach: ko.utils.range(0, maxPageIndex) --\x3e\x3c!-- ko if:$data==currentPageIndex() --\x3e<div class="small oval primary btn"><a href="#" data-bind="text:$data+1, click:function() { currentPageIndex($data); }"></a></div>\x3c!-- /ko --\x3e\x3c!-- ko ifnot:$data==currentPageIndex() --\x3e<div class="small oval default btn"><a href="#" data-bind="text:$data+1, click:function() { currentPageIndex($data); }"></a></div>\x3c!-- /ko --\x3e\x3c!-- /ko --\x3e<div class="small oval default btn"><a href="#" data-bind="click:function() { gotoNextPage(); }">>></a></div>\x3c!-- /ko --\x3e</div></div>\x3c!-- /ko --\x3e'); ko.bindingHandlers.agoGrid={init:function(){return{controlsDescendantBindings:!0}},update:function(a,d,b,f,g){for(;a.firstChild;)ko.removeNode(a.firstChild);f=g.createChildContext(g.$rawData,"$template",function(a){ko.utils.extend(a,d())});g=b.get("agoGridTemplate")||"ko_agoGrid_grid";var e=b.get("agoGridHeaderTemplate")||"ko_agoGrid_header";footerTemplateName=b.get("agoGridFooterTemplate")||"ko_agoGrid_footer";b=a.appendChild(document.createElement("DIV"));ko.renderTemplate(e,f,{templateEngine:c}, b,"replaceNode");b=a.appendChild(document.createElement("DIV"));ko.renderTemplate(g,f,{templateEngine:c},b,"replaceNode");a=a.appendChild(document.createElement("DIV"));ko.renderTemplate(footerTemplateName,f,{templateEngine:c},a,"replaceNode")}}})();
